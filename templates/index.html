<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Gemini Pool Management Console</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    
    <!-- Socket.IO Client Library -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <!-- [NEW] SVG Icon Definitions -->
    <svg width="0" height="0" style="display: none;">
        <symbol id="icon-users" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></symbol>
        <symbol id="icon-robot" viewBox="0 0 24 24"><path d="M12 8V4H8"></path><rect x="4" y="12" width="16" height="8" rx="2"></rect><path d="M2 12h20"></path><path d="M12 12V8a4 4 0 0 0-4-4"></path></symbol>
        <symbol id="icon-settings" viewBox="0 0 24 24"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></symbol>
        <symbol id="icon-server" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></symbol>
        <symbol id="icon-list" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></symbol>
        <symbol id="icon-plus" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></symbol>
        <symbol id="icon-check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></symbol>
        <symbol id="icon-x" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></symbol>
        <symbol id="icon-refresh" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></symbol>
        <symbol id="icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></symbol>
        <symbol id="icon-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></symbol>
        <symbol id="icon-message" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></symbol>
        <symbol id="icon-play" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></symbol>
        <symbol id="icon-pause" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></symbol>
        <symbol id="icon-zap" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></symbol>
        <symbol id="icon-key" viewBox="0 0 24 24"><path d="M21 2l-2 2"></path><path d="M9 6l-2 2"></path><circle cx="7.5" cy="15.5" r="5.5"></circle><path d="M21 2l-9.6 9.6"></path><path d="M15.5 7.5l3 3"></path><path d="M16 13l-3-3"></path></symbol>
    </svg>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">G</div>
                <h1>Business Gemini Pool <span>Console</span></h1>
            </div>
            <div class="header-right">
                <div class="status-indicator" id="serviceStatus">Service Running</div>
                <div class="log-level-control">
                    <label for="logLevelSelect">Logs</label>
                    <select id="logLevelSelect" class="log-level-select" onchange="updateLogLevel(this.value)">
                        <option value="DEBUG">DEBUG</option>
                        <option value="INFO" selected>INFO</option>
                        <option value="ERROR">ERROR</option>
                    </select>
                </div>
                <button class="btn btn-outline" id="loginButton" style="padding: 8px 12px;" onclick="showLoginModal()">Login</button>
                <a href="chat_history.html" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px; text-decoration: none; display: flex; align-items: center; gap: 6px;" title="Go to Chat">
                    <svg class="icon" style="width: 16px; height: 16px;"><use xlink:href="#icon-message"></use></svg>
                    Chat
                </a>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    <span id="themeIconContainer">
                        <svg class="icon"><use xlink:href="#icon-sun"></use></svg>
                    </span>
                </button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('accounts')">
                <svg class="icon tab-icon"><use xlink:href="#icon-users"></use></svg>
                Accounts
            </button>
            <button class="tab" onclick="switchTab('models')">
                <svg class="icon tab-icon"><use xlink:href="#icon-robot"></use></svg>
                Models
            </button>
            <button class="tab" onclick="switchTab('settings')">
                <svg class="icon tab-icon"><use xlink:href="#icon-settings"></use></svg>
                Settings
            </button>
            <button class="tab" onclick="switchTab('apiKeys')">
                <svg class="icon tab-icon"><use xlink:href="#icon-key"></use></svg>
                API Keys
            </button>
        </div>

        <!-- Account Management -->
        <div id="accounts" class="tab-content active">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-info-top">
                        <p>Total Accounts</p>
                        <div class="stat-icon blue"><svg class="icon"><use xlink:href="#icon-users"></use></svg></div>
                    </div>
                    <div class="stat-info-bottom">
                        <h3 id="totalAccounts">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-info-top">
                        <p>Available</p>
                        <div class="stat-icon green"><svg class="icon"><use xlink:href="#icon-check"></use></svg></div>
                    </div>
                    <div class="stat-info-bottom">
                        <h3 id="availableAccounts">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-info-top">
                        <p>Unavailable</p>
                        <div class="stat-icon red"><svg class="icon"><use xlink:href="#icon-x"></use></svg></div>
                    </div>
                    <div class="stat-info-bottom">
                        <h3 id="unavailableAccounts">0</h3>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-info-top">
                        <p>Rotation Index</p>
                        <div class="stat-icon yellow"><svg class="icon"><use xlink:href="#icon-refresh"></use></svg></div>
                    </div>
                    <div class="stat-info-bottom">
                        <h3 id="currentIndex">0</h3>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <svg class="icon card-title-icon"><use xlink:href="#icon-list"></use></svg>
                        Account List
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <a href="account_extractor.html" target="_blank" class="btn btn-outline" style="text-decoration: none;">
                            <svg class="icon"><use xlink:href="#icon-zap"></use></svg>
                            Extractor Tool
                        </a>
                        <button class="btn btn-primary" onclick="showAddAccountModal()">
                            <svg class="icon"><use xlink:href="#icon-plus"></use></svg>
                            Add Account
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="accountsTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Team ID</th>
                                <th>Temp Email</th>
                                <th>User Agent</th>
                                <th>Status</th>
                                <th>Quota Usage</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="accountsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Model Management -->
        <div id="models" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <svg class="icon card-title-icon"><use xlink:href="#icon-robot"></use></svg>
                        Model List
                    </div>
                    <button class="btn btn-primary" onclick="showAddModelModal()">
                        <svg class="icon"><use xlink:href="#icon-plus"></use></svg>
                        Add Model
                    </button>
                </div>
                <div class="table-container">
                    <table id="modelsTable">
                        <thead>
                            <tr>
                                <th>Model ID</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Context Length</th>
                                <th>Max Tokens</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="modelsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- System Settings -->
        <div id="settings" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                         <svg class="icon card-title-icon"><use xlink:href="#icon-settings"></use></svg>
                        System Config
                    </div>
                </div>
                <div class="card-body">
                    <form id="settingsForm">
                        <div class="settings-section">
                            <h3>Proxy Settings</h3>
                            <div class="form-group">
                                <div style="display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--card-bg); border: 2px solid var(--border); border-radius: var(--radius-md); transition: var(--transition-ease);" id="proxyContainer">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                            <svg class="icon" style="width: 20px; height: 20px; color: var(--primary);"><use xlink:href="#icon-server"></use></svg>
                                            <label style="font-size: 16px; font-weight: 600; color: var(--text-main); cursor: pointer; margin: 0;" for="proxyEnabled">Enable Proxy</label>
                                        </div>
                                        <small style="display: block; color: var(--text-muted); margin-left: 32px;">The configured proxy address is only used when enabled. When disabled, the system default proxy is ignored.</small>
                                    </div>
                                    <label class="toggle-switch" for="proxyEnabled" style="position: relative; display: inline-block; width: 56px; height: 32px; cursor: pointer; flex-shrink: 0;">
                                        <input type="checkbox" id="proxyEnabled" style="opacity: 0; width: 0; height: 0;">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="proxyUrl">Proxy Address</label>
                                <input type="text" class="form-input" id="proxyUrl" placeholder="http://127.0.0.1:7890">
                                <small>Proxy server address for accessing Google APIs</small>
                                <div class="proxy-status" id="proxyStatus"></div>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <button type="button" class="btn btn-outline" onclick="testProxy()">
                                    Test Proxy
                                </button>
                                <button type="button" class="btn btn-primary" onclick="saveSettings()">
                                    Save Settings
                                </button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>File Upload Service (cfbed)</h3>
                            <div class="form-group">
                                <label class="form-label" for="uploadEndpoint">Upload Endpoint</label>
                                <input type="text" class="form-input" id="uploadEndpoint" placeholder="https://cfbed.sanyue.de/upload">
                                <small>cfbed upload service address. Generated images/videos will be automatically uploaded to the public web.</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="uploadApiToken">API Token</label>
                                <input type="password" class="form-input" id="uploadApiToken" placeholder="API Token from cfbed management interface">
                                <small>API Token with upload permissions</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="imageBaseUrl">Image Base URL (Optional)</label>
                                <input type="text" class="form-input" id="imageBaseUrl" placeholder="https://cfbed.sanyue.de">
                                <small>Base URL for accessing images. If empty, it will be inferred from the upload endpoint.</small>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <button type="button" class="btn btn-primary" onclick="saveSettings()">
                                    Save Settings
                                </button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Temp Mail Worker API</h3>
                            <div class="form-group">
                                <label class="form-label" for="tempmailWorkerUrl">Worker API URL (Optional)</label>
                                <input type="text" class="form-input" id="tempmailWorkerUrl" placeholder="https://worker-name.your-subdomain.workers.dev">
                                <small>Temp Mail Worker API URL. Required if the Worker and frontend are on different domains. Leave empty to extract from the Temp Email URL.</small>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <button type="button" class="btn btn-primary" onclick="saveSettings()">
                                    Save Settings
                                </button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Auto Cookie Refresh</h3>
                            <div class="form-group">
                                <div style="display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--card-bg); border: 2px solid var(--border); border-radius: var(--radius-md); transition: var(--transition-ease);" id="autoRefreshContainer">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                            <svg class="icon" style="width: 20px; height: 20px; color: var(--primary);"><use xlink:href="#icon-refresh"></use></svg>
                                            <label style="font-size: 16px; font-weight: 600; color: var(--text-main); cursor: pointer; margin: 0;" for="autoRefreshCookie">Enable Auto Cookie Refresh</label>
                                        </div>
                                        <small style="display: block; color: var(--text-muted); margin-left: 32px;">If enabled, the system checks and refreshes expired cookies every hour (Requires Playwright: pip install playwright && playwright install chromium)</small>
                                    </div>
                                    <label class="toggle-switch" for="autoRefreshCookie" style="position: relative; display: inline-block; width: 56px; height: 32px; cursor: pointer; flex-shrink: 0;">
                                        <input type="checkbox" id="autoRefreshCookie" onchange="toggleAutoRefresh()" style="opacity: 0; width: 0; height: 0;">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div id="autoRefreshStatus" style="margin-top: 12px; padding: 12px; background: var(--hover-bg); border-radius: var(--radius-sm); display: none;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span id="autoRefreshStatusText"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3><svg class="icon" style="width: 1em; height: 1em; vertical-align: -2px; margin-right: 8px;"><use xlink:href="#icon-server"></use></svg>Service Info</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Service Port</label>
                                    <input type="text" class="form-input" id="servicePort" value="8000" disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">API Address</label>
                                    <input type="text" class="form-input" id="apiUrl" value="http://localhost:8000/v1" disabled>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Configuration File</h3>
                             <div class="form-group">
                                <label class="form-label" for="configJson">Current Config (JSON)</label>
                                <textarea class="form-textarea" id="configJson" rows="15" readonly></textarea>
                                <small>Config File Path: business_gemini_session.json</small>
                            </div>
                             <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button type="button" class="btn btn-outline" onclick="refreshConfig()">
                                    Refresh Config
                                </button>
                                <button type="button" class="btn btn-outline" onclick="downloadConfig()">
                                    Download Config
                                </button>
                                <button type="button" class="btn btn-primary" onclick="uploadConfig()">
                                    Import Config
                                </button>
                                <input type="file" id="configFileInput" accept=".json" style="display: none;" onchange="handleConfigUpload(event)">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- API Key Management -->
        <div id="apiKeys" class="tab-content">
            <div class="card">
                <div class="card-header" style="display:flex; justify-content:space-between; align-items:center;">
                    <div class="card-title" style="display:flex; align-items:center; gap:8px;">
                        <svg class="icon card-title-icon"><use xlink:href="#icon-key"></use></svg>
                        API Key Management
                    </div>
                    <div class="token-actions">
                        <button class="btn btn-primary" type="button" onclick="openCreateApiKeyModal()">Create API Key</button>
                        <button class="btn btn-outline" type="button" onclick="loadApiKeys()">Refresh List</button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="apiKeysListMain" style="margin-top: 16px;">
                        <div class="empty-state">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="addAccountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Account</h3>
                <button class="modal-close" onclick="closeModal('addAccountModal')" title="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="newAccountJson">Paste Account JSON (from extractor tool)</label>
                    <textarea class="form-textarea" id="newAccountJson" placeholder='{"team_id":"...","secure_c_ses":"...","host_c_oses":"...","csesidx":"...","user_agent":"..."}' rows="4"></textarea>
                    <div style="display:flex; gap:8px; margin-top:8px;">
                        <button class="btn btn-outline btn-sm" type="button" onclick="parseAccountJson()">Parse & Fill</button>
                        <button class="btn btn-outline btn-sm" type="button" onclick="pasteAccountJson()">Read from Clipboard & Fill</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="newTeamId">Team ID</label>
                    <input type="text" class="form-input" id="newTeamId" placeholder="Enter Team ID">
                </div>
                <div class="form-group">
                    <label class="form-label" for="newSecureCses">Cookie __Secure-C_SES</label>
                    <textarea class="form-textarea" id="newSecureCses" placeholder="Enter __Secure-C_SES from Cookie" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="newHostCoses">Cookie __Host-C_OSES</label>
                    <textarea class="form-textarea" id="newHostCoses" placeholder="Enter __Host-C_OSES from Cookie" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="newCsesidx">CSESIDX</label>
                    <input type="text" class="form-input" id="newCsesidx" placeholder="Enter CSESIDX">
                </div>
                <div class="form-group">
                    <label class="form-label" for="newUserAgent">User Agent</label>
                    <input type="text" class="form-input" id="newUserAgent" placeholder="Enter User Agent">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('addAccountModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveNewAccount()">Save</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Account Modal -->
    <div class="modal" id="editAccountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Account</h3>
                <button class="modal-close" onclick="closeModal('editAccountModal')" title="Close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editAccountId">
                <div class="form-group">
                    <label class="form-label" for="editTeamId">Team ID</label>
                    <input type="text" class="form-input" id="editTeamId" placeholder="Enter Team ID">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editSecureCses">Cookie __Secure-C_SES</label>
                    <textarea class="form-textarea" id="editSecureCses" placeholder="Enter Secure C Ses" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editHostCoses">Cookie __Host-C_OSES</label>
                    <textarea class="form-textarea" id="editHostCoses" placeholder="Enter Host C Oses" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editCsesidx">CSESIDX</label>
                    <input type="text" class="form-input" id="editCsesidx" placeholder="Enter CSESIDX">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editUserAgent">User Agent</label>
                    <input type="text" class="form-input" id="editUserAgent" placeholder="Enter User Agent">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editTempmailName">Temp Email Name</label>
                    <input type="text" class="form-input" id="editTempmailName" placeholder="Enter Temp Email Name (for display)">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editTempmailUrl">Temp Email URL</label>
                    <textarea class="form-textarea" id="editTempmailUrl" placeholder="Enter Temp Email URL (for auto refresh, includes JWT token)" rows="2"></textarea>
                    <small style="color: var(--text-muted); font-size: 11px;">Example: https://tempmail.example.com/?jwt=...</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editAccountModal')">Cancel</button>
                <button class="btn btn-primary" onclick="updateAccount()">Save</button>
            </div>
        </div>
    </div>

    <!-- Refresh Cookie Modal -->
    <div class="modal" id="refreshCookieModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Refresh Account Cookie</h3>
                <button class="modal-close" onclick="closeModal('refreshCookieModal')" title="Close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="refreshAccountId">
                <p class="text-muted" style="margin-bottom: 16px;">Please enter the new Cookie value to refresh account authentication. Refreshing will clear the JWT cache.</p>
                <div class="form-group">
                    <label class="form-label" for="refreshSecureCses">Cookie __Secure-C_SES <span style="color: var(--danger);">*</span></label>
                    <textarea class="form-textarea" id="refreshSecureCses" placeholder="Enter new __Secure-C_SES value" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="refreshHostCoses">Cookie __Host-C_OSES <span style="color: var(--danger);">*</span></label>
                    <textarea class="form-textarea" id="refreshHostCoses" placeholder="Enter new __Host-C_OSES value" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="refreshCsesidx">CSESIDX (Optional)</label>
                    <input type="text" class="form-input" id="refreshCsesidx" placeholder="Enter CSESIDX value">
                </div>
                <div class="form-group">
                    <label class="form-label" for="refreshCookieJson">Paste from JSON (Optional)</label>
                    <textarea class="form-textarea" id="refreshCookieJson" placeholder="Paste Cookie JSON data" rows="3"></textarea>
                    <button class="btn btn-outline" style="margin-top: 8px;" onclick="pasteRefreshCookieJson()">ðŸ“‹ Paste & Parse</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('refreshCookieModal')">Cancel</button>
                <button class="btn btn-outline" onclick="autoRefreshAccountCookie()" id="autoRefreshBtn" style="display: none;">Auto Refresh</button>
                <button class="btn btn-primary" onclick="refreshAccountCookie()">Manual Refresh</button>
            </div>
        </div>
    </div>

    <!-- Add Model Modal -->
    <div class="modal" id="addModelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Model</h3>
                <button class="modal-close" onclick="closeModal('addModelModal')" title="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="newModelId">Model ID</label>
                        <input type="text" class="form-input" id="newModelId" placeholder="e.g.: gemini-pro">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="newModelName">Model Name</label>
                        <input type="text" class="form-input" id="newModelName" placeholder="e.g.: Gemini Pro">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="newModelDesc">Description</label>
                    <input type="text" class="form-input" id="newModelDesc" placeholder="Model description">
                </div>
                <div class="form-group">
                    <label class="form-label" for="newApiModelId">API Model ID (Optional)</label>
                    <input type="text" class="form-input" id="newApiModelId" placeholder="Actual Gemini API Model ID, e.g.: gemini-3-pro-preview">
                    <small class="text-muted">If unset, Model ID above will be used.</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="newContextLength">Context Length</label>
                        <input type="number" class="form-input" id="newContextLength" value="32768">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="newMaxTokens">Max Tokens</label>
                        <input type="number" class="form-input" id="newMaxTokens" value="8192">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('addModelModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveNewModel()">Save</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Admin Login</h3>
                <button class="modal-close" onclick="closeModal('loginModal')" title="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="loginPassword">Admin Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter admin password">
                </div>
                <p class="text-muted" style="font-size: 12px;">The first login will set the current password as the admin password.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('loginModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitLogin()">Login</button>
            </div>
        </div>
    </div>

    <!-- Edit Model Modal -->
    <div class="modal" id="editModelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Model</h3>
                <button class="modal-close" onclick="closeModal('editModelModal')" title="Close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editModelOriginalId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editModelId">Model ID</label>
                        <input type="text" class="form-input" id="editModelId" placeholder="e.g.: gemini-pro">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editModelName">Model Name</label>
                        <input type="text" class="form-input" id="editModelName" placeholder="e.g.: Gemini Pro">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editModelDesc">Description</label>
                    <input type="text" class="form-input" id="editModelDesc" placeholder="Model description">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editApiModelId">API Model ID (Optional)</label>
                    <input type="text" class="form-input" id="editApiModelId" placeholder="Actual Gemini API Model ID, e.g.: gemini-3-pro-preview">
                    <small class="text-muted">If unset, Model ID above will be used.</small>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editContextLength">Context Length</label>
                        <input type="number" class="form-input" id="editContextLength">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editMaxTokens">Max Tokens</label>
                        <input type="number" class="form-input" id="editMaxTokens">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editModelModal')">Cancel</button>
                <button class="btn btn-primary" onclick="updateModel()">Save</button>
            </div>
        </div>
    </div>


    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container">
        <!-- Toasts will be injected here by JS -->
    </div>
    <div class="toast" id="toast"></div>

    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    

    <!-- Create API Key Modal -->
    <div class="modal" id="createApiKeyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create API Key</h3>
                <button class="modal-close" onclick="closeModal('createApiKeyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="newApiKeyName">Key Name *</label>
                    <input type="text" class="form-input" id="newApiKeyName" placeholder="e.g.: Production Key">
                </div>
                <div class="form-group">
                    <label class="form-label" for="newApiKeyDescription">Description (Optional)</label>
                    <textarea class="form-textarea" id="newApiKeyDescription" placeholder="Key usage description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="newApiKeyExpiresDays">Expires In Days (Optional)</label>
                    <input type="number" class="form-input" id="newApiKeyExpiresDays" placeholder="Leave empty for no expiration" min="1">
                    <small>Set expiration in days, leave empty for permanent key</small>
                </div>
                <div id="newApiKeyResult" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createApiKeyModal')">Cancel</button>
                <button class="btn btn-primary" onclick="createApiKey()">Create</button>
            </div>
        </div>
    </div>

    <!-- API Key Stats Modal -->
    <div class="modal" id="apiKeyStatsModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>API Key Stats</h3>
                <button class="modal-close" onclick="closeModal('apiKeyStatsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="apiKeyStatsContent">
                    <div class="empty-state">Loading...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('apiKeyStatsModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- API Key Logs Modal -->
    <div class="modal" id="apiKeyLogsModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3>API Call Logs</h3>
                <button class="modal-close" onclick="closeModal('apiKeyLogsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="apiKeyLogsContent">
                    <div class="empty-state">Loading...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('apiKeyLogsModal')">Close</button>
            </div>
        </div>
    </div>

</body>
</html>
